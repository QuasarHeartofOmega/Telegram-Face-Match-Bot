# Telegram Face Match Bot

Этот Telegram-бот реализует механику обмена фотографиями между пользователями и владельцем бота. Пользователи должны пройти проверку: бот использует библиотеку `face_recognition`, чтобы убедиться, что на загруженных фото присутствует лицо человека. За каждое проверенное фото пользователь получает одно случайное фото владельца. После завершения обмена пользователи получают доступ к информации о владельце (интересы, кого ищет, о себе) и могут выразить свой интерес, отправив свои данные владельцу.

## Особенности

*   **Проверка лица:** Использует `face_recognition` для проверки, что на фото пользователя есть лицо.
*   **Обмен фото:** Пользователь отправляет `N` фото, бот проверяет их и за каждое отправляет одно случайное фото владельца.
*   **Роли:**
    *   **Владелец бота:** Имеет специальное меню (`/start`) для настройки своего профиля: загрузка фото, установка интересов, описание "кого ищу", описание "о себе".
    *   **Обычные пользователи:** Проходят процесс проверки и обмена, затем получают доступ к меню с информацией о владельце и возможностью выразить интерес.
*   **Персистентность данных:** Использует `SQLite` для хранения:
    *   Данных владельца (фото, интересы, "кого ищу", "о себе").
    *   Информации о пользователях, выразивших интерес (ID, username, фото, "о себе").
*   **Меню и состояния:** Использует `ConversationHandler` для управления состояниями владельца (настройка данных) и `user_data` для отслеживания состояния обычных пользователей (ожидание фото, в главном меню, редактирование "о себе").

## Как это работает

### Для владельца:

1.  Получает специальное меню по команде `/start`.
2.  Может:
    *   Загрузить свои фото (до 10 в одном сообщении, можно несколько раз).
    *   Установить/просмотреть свои интересы.
    *   Установить/просмотреть описание "кого ищу".
    *   Установить/просмотреть описание "о себе".
    *   Очистить любое из полей или все фото.

### Для обычного пользователя:

1.  Отправляет команду `/start`.
2.  Бот запрашивает `REQUIRED_USER_PHOTOS` (по умолчанию 2) фото.
3.  Пользователь отправляет фото по одному.
4.  Бот проверяет каждое фото на наличие лица.
    *   Если лицо найдено: фото принимается, пользователю отправляется одно случайное фото владельца (которое он ещё не получал). Счетчик увеличивается.
    *   Если лицо не найдено: пользователь получает уведомление об ошибке и может отправить другое фото.
    *   Если фото уже было отправлено ранее: пользователь получает уведомление о дубликате.
5.  Когда пользователь отправляет требуемое количество фото:
    *   Открывается главное меню.
    *   Пользователь может:
        *   Просмотреть все фото владельца.
        *   Просмотреть интересы владельца.
        *   Просмотреть "кого ищет" владелец.
        *   Добавить/изменить собственное сообщение "О себе" (минимум `MIN_ABOUT_TEXT_LENGTH` символов). Эта кнопка становится активной только после заполнения.
        *   Нажать кнопку "Заинтересована" (активна только после заполнения "О себе"). При нажатии:
            *   Информация о пользователе (ID, username, "о себе") отправляется владельцу.
            *   Все проверенные фото пользователя отправляются владельцу.
            *   Информация сохраняется в базе данных.
            *   Повторное нажатие блокируется.

## Технологии

*   Python 3.6+
*   `python-telegram-bot` v12.8
*   `face_recognition`
*   `Pillow (PIL)`
*   `NumPy`
*   `SQLite3`

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/yourusername/Telegram-Face-Match-Bot.git
    cd Telegram-Face-Match-Bot
    ```
2.  **Создайте виртуальное окружение (рекомендуется):**
    ```bash
    python3 -m venv venv
    source venv/bin/activate # На Windows: venv\Scripts\activate
    ```
3.  **Установите зависимости:**
    ```bash
    pip install python-telegram-bot==12.8 face_recognition Pillow numpy
    ```
    *Примечание:* Установка `face_recognition` может потребовать предварительной установки `cmake` и `dlib`. Следуйте инструкциям для вашей ОС, если возникнут ошибки.
4.  **Настройте конфигурацию:**
    *   Откройте скрипт `bot.py`.
    *   Замените `TOKEN = 'YOUR_BOT_TOKEN'` на токен вашего Telegram-бота (полученный от [@BotFather](https://t.me/BotFather)).
    *   Замените `OWNER_ID = 123456789` на ваш Telegram ID (можно узнать, например, у [@userinfobot](https://t.me/userinfobot) или отправив боту команду `/start` и проверив логи).
    *   При необходимости измените значения `REQUIRED_USER_PHOTOS` и `MIN_ABOUT_TEXT_LENGTH`.
5.  **Запустите бота:**
    ```bash
    python bot.py
    ```
    Бот должен начать логгирование и ожидать сообщений.

## Структура проекта

*   `bot.py`: Основной скрипт бота.
*   `bot_data.db`: Файл базы данных SQLite (создается автоматически при первом запуске).
*   `README.md`: Этот файл.

## Вклад

Вклад в развитие проекта приветствуется! Пожалуйста, создавайте `Issues` для сообщений об ошибках или предложениях новых функций и `Pull Requests` для внесения изменений.

## Лицензия

MIT

## Признательность

*   [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot)
*   [ageitgey/face_recognition](https://github.com/ageitgey/face_recognition)
